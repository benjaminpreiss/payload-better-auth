{"version":3,"sources":["../../src/storage/RedisStorage.ts"],"sourcesContent":["import type { SecondaryStorage } from './types'\n\n/**\n * Minimal Redis client interface.\n * Compatible with ioredis, redis, and other Redis clients.\n */\nexport interface RedisClient {\n  del(key: string): Promise<number>\n  get(key: string): Promise<null | string>\n  set(key: string, value: string, ...args: unknown[]): Promise<unknown>\n}\n\nexport interface RedisStorageOptions {\n  /**\n   * Key prefix for all stored values.\n   * @default 'ba:'\n   */\n  prefix?: string\n\n  /**\n   * Redis client instance.\n   *\n   * @example\n   * import Redis from 'ioredis'\n   * const redis = new Redis()\n   */\n  redis: RedisClient\n}\n\n/**\n * Create a Redis-backed storage adapter.\n *\n * Suitable for:\n * - Multi-server / distributed deployments\n * - Production environments\n *\n * Requires a Redis server.\n *\n * @example\n * import Redis from 'ioredis'\n * import { createRedisStorage } from 'payload-better-auth'\n *\n * const redis = new Redis(process.env.REDIS_URL)\n * const storage = createRedisStorage({ redis })\n */\nexport function createRedisStorage(options: RedisStorageOptions): SecondaryStorage {\n  const { prefix = 'ba:', redis } = options\n\n  return {\n    async delete(key: string): Promise<void> {\n      await redis.del(prefix + key)\n    },\n\n    async get(key: string): Promise<null | string> {\n      return redis.get(prefix + key)\n    },\n\n    async set(key: string, value: string, ttl?: number): Promise<void> {\n      if (ttl) {\n        // Use EX for seconds TTL\n        await redis.set(prefix + key, value, 'EX', ttl)\n      } else {\n        await redis.set(prefix + key, value)\n      }\n    },\n  }\n}\n"],"names":["createRedisStorage","options","prefix","redis","delete","key","del","get","set","value","ttl"],"mappings":"AA6BA;;;;;;;;;;;;;;;CAeC,GACD,OAAO,SAASA,mBAAmBC,OAA4B;IAC7D,MAAM,EAAEC,SAAS,KAAK,EAAEC,KAAK,EAAE,GAAGF;IAElC,OAAO;QACL,MAAMG,QAAOC,GAAW;YACtB,MAAMF,MAAMG,GAAG,CAACJ,SAASG;QAC3B;QAEA,MAAME,KAAIF,GAAW;YACnB,OAAOF,MAAMI,GAAG,CAACL,SAASG;QAC5B;QAEA,MAAMG,KAAIH,GAAW,EAAEI,KAAa,EAAEC,GAAY;YAChD,IAAIA,KAAK;gBACP,yBAAyB;gBACzB,MAAMP,MAAMK,GAAG,CAACN,SAASG,KAAKI,OAAO,MAAMC;YAC7C,OAAO;gBACL,MAAMP,MAAMK,GAAG,CAACN,SAASG,KAAKI;YAChC;QACF;IACF;AACF"}