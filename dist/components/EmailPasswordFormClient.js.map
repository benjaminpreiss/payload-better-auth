{"version":3,"sources":["../../src/components/EmailPasswordFormClient.tsx"],"sourcesContent":["'use client'\n\nimport type { ChangeEvent, default as React } from 'react'\n\nimport { Button, FieldLabel, TextInput } from '@payloadcms/ui'\nimport { magicLinkClient } from 'better-auth/client/plugins'\nimport { createAuthClient } from 'better-auth/react'\nimport { useRouter } from 'next/navigation.js'\nimport { useState } from 'react'\n\nimport type { AuthMethod } from '../better-auth/helpers.js'\n\ninterface FormErrors {\n  email?: string\n  general?: string\n  password?: string\n}\n\nexport function EmailPasswordFormClient({\n  authClientOptions,\n  authMethods,\n}: {\n  authClientOptions: Parameters<typeof createAuthClient>['0']\n  authMethods: AuthMethod[]\n}) {\n  const authClient = createAuthClient({\n    ...authClientOptions,\n    plugins: [\n      ...(authClientOptions?.plugins?.filter((p) => p.id !== 'magic-link') ?? []),\n      magicLinkClient(),\n    ],\n  })\n  const router = useRouter()\n  const [errors, setErrors] = useState<FormErrors>({})\n  const [isLoading, setIsLoading] = useState(false)\n\n  // Use useField hooks for each input to get proper setValue functions\n  const [emailValue, setEmailValue] = useState('')\n  const [passwordValue, setPasswordValue] = useState('')\n\n  const withEmailAndPassword = authMethods.find((m) => m.method === 'emailAndPassword')\n  const withMagicLink = authMethods.find((m) => m.method === 'magicLink')\n\n  if (!withEmailAndPassword && !withMagicLink) {\n    throw new Error(\"This Form can't render with neither email nor magicLink activated.\")\n  }\n\n  const handleEmailChange = (event: ChangeEvent<HTMLInputElement>) => {\n    setEmailValue(event.target.value)\n    // Clear field-specific error when user starts typing\n    if (errors.email) {\n      setErrors((prev) => ({ ...prev, email: undefined }))\n    }\n  }\n\n  const handlePasswordChange = (event: ChangeEvent<HTMLInputElement>) => {\n    setPasswordValue(event.target.value)\n    // Clear field-specific error when user starts typing\n    if (errors.password) {\n      setErrors((prev) => ({ ...prev, password: undefined }))\n    }\n  }\n\n  const validateForm = (): boolean => {\n    const newErrors: FormErrors = {}\n    const email = String(emailValue || '').trim()\n    const password = String(passwordValue || '').trim()\n\n    if (!email) {\n      newErrors.email = 'Email is required'\n    } else if (!/^[^\\s@]+@[^\\s@][^\\s.@]*\\.[^\\s@]+$/.test(email)) {\n      newErrors.email = 'Please enter a valid email address'\n    }\n\n    if (withEmailAndPassword && !withMagicLink) {\n      if (!password) {\n        newErrors.password = 'Password is required'\n        // TODO: verify if minPasswordLength is also set if not actively specified\n      } else if (password.length < withEmailAndPassword.options.minPasswordLength) {\n        newErrors.password = `Password must be at least ${withEmailAndPassword.options.minPasswordLength} characters`\n      }\n    }\n\n    setErrors(newErrors)\n    return Object.keys(newErrors).length === 0\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n\n    if (!validateForm()) {\n      return\n    }\n\n    setIsLoading(true)\n    setErrors({})\n\n    try {\n      if (withEmailAndPassword && passwordValue !== '') {\n        const result = await authClient.signIn.email({\n          email: String(emailValue || ''),\n          password: String(passwordValue || ''),\n        })\n\n        if (result.error) {\n          setErrors({\n            general: result.error.message || 'Sign in failed. Please check your credentials.',\n          })\n        } else {\n          // Successful sign in - redirect to admin\n          router.push('/admin')\n          router.refresh()\n        }\n      } else if (withMagicLink && passwordValue === '') {\n        const result = await authClient.signIn.magicLink({\n          callbackURL: `${window.location.origin}/admin`,\n          email: String(emailValue || ''),\n        })\n\n        if (result.error) {\n          setErrors({\n            general: result.error.message || 'Sign in failed. Please check your credentials.',\n          })\n        } else {\n          // Successful sign in - redirect to admin\n          router.push('/admin/auth/verify-email')\n          router.refresh()\n        }\n      }\n    } catch (error) {\n      setErrors({\n        general: (error as Error).message,\n      })\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const errorStyle = {\n    color: '#dc2626',\n    fontSize: '0.875rem',\n    marginTop: '0.25rem',\n  }\n\n  return (\n    <form className=\"email-password-form\" onSubmit={handleSubmit}>\n      <div className=\"form-field\" style={{ marginBottom: '1.5rem' }}>\n        <FieldLabel htmlFor=\"email\" label=\"Email\" required />\n        <TextInput\n          onChange={handleEmailChange}\n          path=\"email\"\n          readOnly={isLoading}\n          required\n          value={emailValue || ''}\n        />\n        {errors.email && (\n          <div className=\"field-error\" style={errorStyle}>\n            {errors.email}\n          </div>\n        )}\n      </div>\n\n      <div className=\"form-field\" style={{ marginBottom: '1.5rem' }}>\n        <FieldLabel\n          htmlFor=\"password\"\n          label={`Password ${withMagicLink && '(Optional)'}`}\n          required={!withMagicLink}\n        />\n        <TextInput\n          onChange={handlePasswordChange}\n          path=\"password\"\n          readOnly={isLoading}\n          required={!withMagicLink}\n          value={passwordValue || ''}\n        />\n        {errors.password && (\n          <div className=\"field-error\" style={errorStyle}>\n            {errors.password}\n          </div>\n        )}\n      </div>\n\n      {errors.general && (\n        <div\n          className=\"general-error\"\n          style={{\n            ...errorStyle,\n            backgroundColor: '#fef2f2',\n            border: '1px solid #fecaca',\n            borderRadius: '0.375rem',\n            marginBottom: '1rem',\n            padding: '0.75rem',\n          }}\n        >\n          {errors.general}\n        </div>\n      )}\n\n      <Button buttonStyle=\"primary\" disabled={isLoading} size=\"large\" type=\"submit\">\n        {isLoading ? 'Signing In...' : 'Sign In'}\n      </Button>\n    </form>\n  )\n}\n"],"names":["Button","FieldLabel","TextInput","magicLinkClient","createAuthClient","useRouter","useState","EmailPasswordFormClient","authClientOptions","authMethods","authClient","plugins","filter","p","id","router","errors","setErrors","isLoading","setIsLoading","emailValue","setEmailValue","passwordValue","setPasswordValue","withEmailAndPassword","find","m","method","withMagicLink","Error","handleEmailChange","event","target","value","email","prev","undefined","handlePasswordChange","password","validateForm","newErrors","String","trim","test","length","options","minPasswordLength","Object","keys","handleSubmit","e","preventDefault","result","signIn","error","general","message","push","refresh","magicLink","callbackURL","window","location","origin","errorStyle","color","fontSize","marginTop","form","className","onSubmit","div","style","marginBottom","htmlFor","label","required","onChange","path","readOnly","backgroundColor","border","borderRadius","padding","buttonStyle","disabled","size","type"],"mappings":"AAAA;;AAIA,SAASA,MAAM,EAAEC,UAAU,EAAEC,SAAS,QAAQ,iBAAgB;AAC9D,SAASC,eAAe,QAAQ,6BAA4B;AAC5D,SAASC,gBAAgB,QAAQ,oBAAmB;AACpD,SAASC,SAAS,QAAQ,qBAAoB;AAC9C,SAASC,QAAQ,QAAQ,QAAO;AAUhC,OAAO,SAASC,wBAAwB,EACtCC,iBAAiB,EACjBC,WAAW,EAIZ;IACC,MAAMC,aAAaN,iBAAiB;QAClC,GAAGI,iBAAiB;QACpBG,SAAS;eACHH,mBAAmBG,SAASC,OAAO,CAACC,IAAMA,EAAEC,EAAE,KAAK,iBAAiB,EAAE;YAC1EX;SACD;IACH;IACA,MAAMY,SAASV;IACf,MAAM,CAACW,QAAQC,UAAU,GAAGX,SAAqB,CAAC;IAClD,MAAM,CAACY,WAAWC,aAAa,GAAGb,SAAS;IAE3C,qEAAqE;IACrE,MAAM,CAACc,YAAYC,cAAc,GAAGf,SAAS;IAC7C,MAAM,CAACgB,eAAeC,iBAAiB,GAAGjB,SAAS;IAEnD,MAAMkB,uBAAuBf,YAAYgB,IAAI,CAAC,CAACC,IAAMA,EAAEC,MAAM,KAAK;IAClE,MAAMC,gBAAgBnB,YAAYgB,IAAI,CAAC,CAACC,IAAMA,EAAEC,MAAM,KAAK;IAE3D,IAAI,CAACH,wBAAwB,CAACI,eAAe;QAC3C,MAAM,IAAIC,MAAM;IAClB;IAEA,MAAMC,oBAAoB,CAACC;QACzBV,cAAcU,MAAMC,MAAM,CAACC,KAAK;QAChC,qDAAqD;QACrD,IAAIjB,OAAOkB,KAAK,EAAE;YAChBjB,UAAU,CAACkB,OAAU,CAAA;oBAAE,GAAGA,IAAI;oBAAED,OAAOE;gBAAU,CAAA;QACnD;IACF;IAEA,MAAMC,uBAAuB,CAACN;QAC5BR,iBAAiBQ,MAAMC,MAAM,CAACC,KAAK;QACnC,qDAAqD;QACrD,IAAIjB,OAAOsB,QAAQ,EAAE;YACnBrB,UAAU,CAACkB,OAAU,CAAA;oBAAE,GAAGA,IAAI;oBAAEG,UAAUF;gBAAU,CAAA;QACtD;IACF;IAEA,MAAMG,eAAe;QACnB,MAAMC,YAAwB,CAAC;QAC/B,MAAMN,QAAQO,OAAOrB,cAAc,IAAIsB,IAAI;QAC3C,MAAMJ,WAAWG,OAAOnB,iBAAiB,IAAIoB,IAAI;QAEjD,IAAI,CAACR,OAAO;YACVM,UAAUN,KAAK,GAAG;QACpB,OAAO,IAAI,CAAC,oCAAoCS,IAAI,CAACT,QAAQ;YAC3DM,UAAUN,KAAK,GAAG;QACpB;QAEA,IAAIV,wBAAwB,CAACI,eAAe;YAC1C,IAAI,CAACU,UAAU;gBACbE,UAAUF,QAAQ,GAAG;YACrB,0EAA0E;YAC5E,OAAO,IAAIA,SAASM,MAAM,GAAGpB,qBAAqBqB,OAAO,CAACC,iBAAiB,EAAE;gBAC3EN,UAAUF,QAAQ,GAAG,CAAC,0BAA0B,EAAEd,qBAAqBqB,OAAO,CAACC,iBAAiB,CAAC,WAAW,CAAC;YAC/G;QACF;QAEA7B,UAAUuB;QACV,OAAOO,OAAOC,IAAI,CAACR,WAAWI,MAAM,KAAK;IAC3C;IAEA,MAAMK,eAAe,OAAOC;QAC1BA,EAAEC,cAAc;QAEhB,IAAI,CAACZ,gBAAgB;YACnB;QACF;QAEApB,aAAa;QACbF,UAAU,CAAC;QAEX,IAAI;YACF,IAAIO,wBAAwBF,kBAAkB,IAAI;gBAChD,MAAM8B,SAAS,MAAM1C,WAAW2C,MAAM,CAACnB,KAAK,CAAC;oBAC3CA,OAAOO,OAAOrB,cAAc;oBAC5BkB,UAAUG,OAAOnB,iBAAiB;gBACpC;gBAEA,IAAI8B,OAAOE,KAAK,EAAE;oBAChBrC,UAAU;wBACRsC,SAASH,OAAOE,KAAK,CAACE,OAAO,IAAI;oBACnC;gBACF,OAAO;oBACL,yCAAyC;oBACzCzC,OAAO0C,IAAI,CAAC;oBACZ1C,OAAO2C,OAAO;gBAChB;YACF,OAAO,IAAI9B,iBAAiBN,kBAAkB,IAAI;gBAChD,MAAM8B,SAAS,MAAM1C,WAAW2C,MAAM,CAACM,SAAS,CAAC;oBAC/CC,aAAa,GAAGC,OAAOC,QAAQ,CAACC,MAAM,CAAC,MAAM,CAAC;oBAC9C7B,OAAOO,OAAOrB,cAAc;gBAC9B;gBAEA,IAAIgC,OAAOE,KAAK,EAAE;oBAChBrC,UAAU;wBACRsC,SAASH,OAAOE,KAAK,CAACE,OAAO,IAAI;oBACnC;gBACF,OAAO;oBACL,yCAAyC;oBACzCzC,OAAO0C,IAAI,CAAC;oBACZ1C,OAAO2C,OAAO;gBAChB;YACF;QACF,EAAE,OAAOJ,OAAO;YACdrC,UAAU;gBACRsC,SAAS,AAACD,MAAgBE,OAAO;YACnC;QACF,SAAU;YACRrC,aAAa;QACf;IACF;IAEA,MAAM6C,aAAa;QACjBC,OAAO;QACPC,UAAU;QACVC,WAAW;IACb;IAEA,qBACE,MAACC;QAAKC,WAAU;QAAsBC,UAAUrB;;0BAC9C,MAACsB;gBAAIF,WAAU;gBAAaG,OAAO;oBAAEC,cAAc;gBAAS;;kCAC1D,KAACxE;wBAAWyE,SAAQ;wBAAQC,OAAM;wBAAQC,QAAQ;;kCAClD,KAAC1E;wBACC2E,UAAU/C;wBACVgD,MAAK;wBACLC,UAAU7D;wBACV0D,QAAQ;wBACR3C,OAAOb,cAAc;;oBAEtBJ,OAAOkB,KAAK,kBACX,KAACqC;wBAAIF,WAAU;wBAAcG,OAAOR;kCACjChD,OAAOkB,KAAK;;;;0BAKnB,MAACqC;gBAAIF,WAAU;gBAAaG,OAAO;oBAAEC,cAAc;gBAAS;;kCAC1D,KAACxE;wBACCyE,SAAQ;wBACRC,OAAO,CAAC,SAAS,EAAE/C,iBAAiB,cAAc;wBAClDgD,UAAU,CAAChD;;kCAEb,KAAC1B;wBACC2E,UAAUxC;wBACVyC,MAAK;wBACLC,UAAU7D;wBACV0D,UAAU,CAAChD;wBACXK,OAAOX,iBAAiB;;oBAEzBN,OAAOsB,QAAQ,kBACd,KAACiC;wBAAIF,WAAU;wBAAcG,OAAOR;kCACjChD,OAAOsB,QAAQ;;;;YAKrBtB,OAAOuC,OAAO,kBACb,KAACgB;gBACCF,WAAU;gBACVG,OAAO;oBACL,GAAGR,UAAU;oBACbgB,iBAAiB;oBACjBC,QAAQ;oBACRC,cAAc;oBACdT,cAAc;oBACdU,SAAS;gBACX;0BAECnE,OAAOuC,OAAO;;0BAInB,KAACvD;gBAAOoF,aAAY;gBAAUC,UAAUnE;gBAAWoE,MAAK;gBAAQC,MAAK;0BAClErE,YAAY,kBAAkB;;;;AAIvC"}