{"version":3,"sources":["../../src/components/BetterAuthLoginServer.tsx"],"sourcesContent":["import type { ClientOptions } from 'better-auth'\nimport type React from 'react'\nimport type { AuthMethod } from 'src/better-auth/helpers.js'\n\nimport { EmailPasswordFormClient } from './EmailPasswordFormClient.js'\n\nexport type AuthClientOptions = { baseURL: string } & Omit<ClientOptions, 'baseURL'>\n\nexport async function fetchAuthMethods({\n  additionalHeaders,\n  betterAuthBaseUrl,\n  debug = false,\n}: {\n  additionalHeaders?: HeadersInit\n  betterAuthBaseUrl: string\n  debug?: boolean\n}): Promise<{ data: AuthMethod[]; error: null } | { data: null; error: Error }> {\n  const headers = new Headers(additionalHeaders)\n  headers.append('Content-Type', 'application/json')\n  const url = `${betterAuthBaseUrl}/api/auth/auth/methods`\n\n  if (debug) {\n    console.log('[payload-better-auth] fetchAuthMethods: Attempting to fetch auth methods')\n    console.log('[payload-better-auth] fetchAuthMethods:   - URL:', url)\n    console.log('[payload-better-auth] fetchAuthMethods:   - betterAuthBaseUrl:', betterAuthBaseUrl)\n  }\n\n  try {\n    const response = await fetch(url, {\n      headers,\n      method: 'GET',\n    })\n\n    if (debug) {\n      console.log('[payload-better-auth] fetchAuthMethods: Response received')\n      console.log('[payload-better-auth] fetchAuthMethods:   - status:', response.status)\n      console.log('[payload-better-auth] fetchAuthMethods:   - statusText:', response.statusText)\n    }\n\n    if (!response.ok) {\n      throw new Error(`Failed to fetch auth methods: ${response.status} ${response.statusText}`)\n    }\n\n    const data = await response.json()\n\n    if (debug) {\n      console.log('[payload-better-auth] fetchAuthMethods: Successfully fetched auth methods')\n      console.log('[payload-better-auth] fetchAuthMethods:   - methods count:', data?.length ?? 0)\n    }\n\n    return { data, error: null } as { data: AuthMethod[]; error: null }\n  } catch (error) {\n    console.error('Error fetching auth methods:', error)\n    return { data: null, error: error as Error }\n  }\n}\n\nexport type BetterAuthLoginServerProps = {\n  /**\n   * Enable debug logging for troubleshooting connection issues.\n   */\n  debug?: boolean\n  /**\n   * Auth client options for client-side requests (uses external/public URL).\n   */\n  externalAuthClientOptions: AuthClientOptions\n  /**\n   * Auth client options for server-side requests (uses internal URL).\n   */\n  internalAuthClientOptions: AuthClientOptions\n}\n\nexport async function BetterAuthLoginServer({\n  debug = false,\n  externalAuthClientOptions,\n  internalAuthClientOptions,\n}: BetterAuthLoginServerProps) {\n  const authMethods = await fetchAuthMethods({\n    additionalHeaders: internalAuthClientOptions.fetchOptions?.headers,\n    betterAuthBaseUrl: internalAuthClientOptions.baseURL,\n    debug,\n  })\n\n  return (\n    <div\n      style={{\n        alignItems: 'center',\n        display: 'flex',\n        justifyContent: 'center',\n      }}\n    >\n      <div\n        style={{\n          background: 'white',\n          borderRadius: '8px',\n          boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)',\n          maxWidth: '400px',\n          padding: '2rem',\n          width: '100%',\n        }}\n      >\n        <h2\n          style={{\n            color: '#333',\n            fontSize: '1.5rem',\n            fontWeight: '600',\n            marginBottom: '2rem',\n            textAlign: 'center',\n          }}\n        >\n          Sign In to Admin\n        </h2>\n\n        {authMethods.data?.some(\n          (m) => m.method === 'emailAndPassword' || m.method === 'magicLink',\n        ) && (\n          <EmailPasswordFormClient\n            authClientOptions={externalAuthClientOptions}\n            authMethods={authMethods.data}\n          />\n        )}\n        {authMethods.data?.length === 0 && (\n          <div\n            style={{\n              color: '#666',\n              padding: '2rem',\n              textAlign: 'center',\n            }}\n          >\n            <p>No authentication methods are currently available.</p>\n            <p style={{ fontSize: '0.875rem', marginTop: '1rem' }}>\n              Please contact your administrator.\n            </p>\n          </div>\n        )}\n        {authMethods.error && (\n          <div\n            style={{\n              color: '#666',\n              padding: '2rem',\n              textAlign: 'center',\n            }}\n          >\n            <p>Couldn't fetch authentication methods from better-auth</p>\n            <p style={{ fontSize: '0.875rem', marginTop: '1rem' }}>\n              Please contact your administrator.\n            </p>\n          </div>\n        )}\n      </div>\n    </div>\n  )\n}\n"],"names":["EmailPasswordFormClient","fetchAuthMethods","additionalHeaders","betterAuthBaseUrl","debug","headers","Headers","append","url","console","log","response","fetch","method","status","statusText","ok","Error","data","json","length","error","BetterAuthLoginServer","externalAuthClientOptions","internalAuthClientOptions","authMethods","fetchOptions","baseURL","div","style","alignItems","display","justifyContent","background","borderRadius","boxShadow","maxWidth","padding","width","h2","color","fontSize","fontWeight","marginBottom","textAlign","some","m","authClientOptions","p","marginTop"],"mappings":";AAIA,SAASA,uBAAuB,QAAQ,+BAA8B;AAItE,OAAO,eAAeC,iBAAiB,EACrCC,iBAAiB,EACjBC,iBAAiB,EACjBC,QAAQ,KAAK,EAKd;IACC,MAAMC,UAAU,IAAIC,QAAQJ;IAC5BG,QAAQE,MAAM,CAAC,gBAAgB;IAC/B,MAAMC,MAAM,GAAGL,kBAAkB,sBAAsB,CAAC;IAExD,IAAIC,OAAO;QACTK,QAAQC,GAAG,CAAC;QACZD,QAAQC,GAAG,CAAC,oDAAoDF;QAChEC,QAAQC,GAAG,CAAC,kEAAkEP;IAChF;IAEA,IAAI;QACF,MAAMQ,WAAW,MAAMC,MAAMJ,KAAK;YAChCH;YACAQ,QAAQ;QACV;QAEA,IAAIT,OAAO;YACTK,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,uDAAuDC,SAASG,MAAM;YAClFL,QAAQC,GAAG,CAAC,2DAA2DC,SAASI,UAAU;QAC5F;QAEA,IAAI,CAACJ,SAASK,EAAE,EAAE;YAChB,MAAM,IAAIC,MAAM,CAAC,8BAA8B,EAAEN,SAASG,MAAM,CAAC,CAAC,EAAEH,SAASI,UAAU,EAAE;QAC3F;QAEA,MAAMG,OAAO,MAAMP,SAASQ,IAAI;QAEhC,IAAIf,OAAO;YACTK,QAAQC,GAAG,CAAC;YACZD,QAAQC,GAAG,CAAC,8DAA8DQ,MAAME,UAAU;QAC5F;QAEA,OAAO;YAAEF;YAAMG,OAAO;QAAK;IAC7B,EAAE,OAAOA,OAAO;QACdZ,QAAQY,KAAK,CAAC,gCAAgCA;QAC9C,OAAO;YAAEH,MAAM;YAAMG,OAAOA;QAAe;IAC7C;AACF;AAiBA,OAAO,eAAeC,sBAAsB,EAC1ClB,QAAQ,KAAK,EACbmB,yBAAyB,EACzBC,yBAAyB,EACE;IAC3B,MAAMC,cAAc,MAAMxB,iBAAiB;QACzCC,mBAAmBsB,0BAA0BE,YAAY,EAAErB;QAC3DF,mBAAmBqB,0BAA0BG,OAAO;QACpDvB;IACF;IAEA,qBACE,KAACwB;QACCC,OAAO;YACLC,YAAY;YACZC,SAAS;YACTC,gBAAgB;QAClB;kBAEA,cAAA,MAACJ;YACCC,OAAO;gBACLI,YAAY;gBACZC,cAAc;gBACdC,WAAW;gBACXC,UAAU;gBACVC,SAAS;gBACTC,OAAO;YACT;;8BAEA,KAACC;oBACCV,OAAO;wBACLW,OAAO;wBACPC,UAAU;wBACVC,YAAY;wBACZC,cAAc;wBACdC,WAAW;oBACb;8BACD;;gBAIAnB,YAAYP,IAAI,EAAE2B,KACjB,CAACC,IAAMA,EAAEjC,MAAM,KAAK,sBAAsBiC,EAAEjC,MAAM,KAAK,8BAEvD,KAACb;oBACC+C,mBAAmBxB;oBACnBE,aAAaA,YAAYP,IAAI;;gBAGhCO,YAAYP,IAAI,EAAEE,WAAW,mBAC5B,MAACQ;oBACCC,OAAO;wBACLW,OAAO;wBACPH,SAAS;wBACTO,WAAW;oBACb;;sCAEA,KAACI;sCAAE;;sCACH,KAACA;4BAAEnB,OAAO;gCAAEY,UAAU;gCAAYQ,WAAW;4BAAO;sCAAG;;;;gBAK1DxB,YAAYJ,KAAK,kBAChB,MAACO;oBACCC,OAAO;wBACLW,OAAO;wBACPH,SAAS;wBACTO,WAAW;oBACb;;sCAEA,KAACI;sCAAE;;sCACH,KAACA;4BAAEnB,OAAO;gCAAEY,UAAU;gCAAYQ,WAAW;4BAAO;sCAAG;;;;;;;AAQnE"}