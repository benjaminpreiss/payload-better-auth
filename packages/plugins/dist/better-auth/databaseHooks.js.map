{"version":3,"sources":["../../src/better-auth/databaseHooks.ts"],"sourcesContent":["import type { betterAuth } from 'better-auth'\nimport type { SanitizedConfig } from 'payload'\n\nimport { createDeleteUserFromPayload, createSyncUserToPayload } from './sources.js'\n\nexport function createDatabaseHooks({\n  config,\n}: {\n  config: Promise<SanitizedConfig>\n}): Parameters<typeof betterAuth>['0']['databaseHooks'] {\n  const syncUserToPayload = createSyncUserToPayload(config)\n  const deleteUserFromPayload = createDeleteUserFromPayload(config)\n  return {\n    user: {\n      create: {\n        // After the BA user exists, sync to Payload. On failure, enqueue in memory.\n        after: async (user) => {\n          // push BA-induced ensure to the **front** of the queue\n          await syncUserToPayload(user)\n        },\n      },\n      // TODO: possibly offer \"update\"\n      delete: {\n        after: async (user) => {\n          await deleteUserFromPayload(user.id)\n        },\n      },\n    },\n  }\n}\n"],"names":["createDeleteUserFromPayload","createSyncUserToPayload","createDatabaseHooks","config","syncUserToPayload","deleteUserFromPayload","user","create","after","delete","id"],"mappings":"AAGA,SAASA,2BAA2B,EAAEC,uBAAuB,QAAQ,eAAc;AAEnF,OAAO,SAASC,oBAAoB,EAClCC,MAAM,EAGP;IACC,MAAMC,oBAAoBH,wBAAwBE;IAClD,MAAME,wBAAwBL,4BAA4BG;IAC1D,OAAO;QACLG,MAAM;YACJC,QAAQ;gBACN,4EAA4E;gBAC5EC,OAAO,OAAOF;oBACZ,uDAAuD;oBACvD,MAAMF,kBAAkBE;gBAC1B;YACF;YACA,gCAAgC;YAChCG,QAAQ;gBACND,OAAO,OAAOF;oBACZ,MAAMD,sBAAsBC,KAAKI,EAAE;gBACrC;YACF;QACF;IACF;AACF"}